{% extends "base.html" %}

{% block content %}
<main class="calculator-main">
    <header class="header">
        <p class="label label--accent">Peptide Calculator</p>
        <h1 class="header__title">Clearmix</h1>
        <p class="header__tagline">Mix and measure with confidence</p>
    </header>

    <!-- Mode Selector -->
    <nav class="mode-nav" id="mode-nav">
        <button class="mode-btn mode-btn--active" data-mode="mixing" id="mode-mixing-btn">
            <span class="mode-btn__icon">üß™</span>
            <span class="mode-btn__label">Mixing</span>
            <span class="mode-btn__desc">Reconstitute your vial</span>
        </button>
        <button class="mode-btn" data-mode="dosing" id="mode-dosing-btn">
            <span class="mode-btn__icon">üíâ</span>
            <span class="mode-btn__label">Dosing</span>
            <span class="mode-btn__desc">Calculate your dose</span>
        </button>
    </nav>

    <!-- ============================================
         MIXING SCREEN
         ============================================ -->
    <section class="screen" id="mixing-screen">
        <section class="disclaimer">
            <strong>Note:</strong> This tool provides math and measurement guidance only.
            Always confirm with your prescriber.
        </section>

        <!-- What You Have -->
        <section class="card">
            <div class="card__header">
                <span class="card__title">What's in Your Vial?</span>
            </div>

            <div class="input-group">
                <label class="input-group__label">Peptide amount</label>
                <p class="input-group__hint">
                    Check the label on your vial. Common sizes are 5 mg, 10 mg, or 15 mg.
                    <em class="example">Example: A vial labeled "BPC-157 5mg" contains 5 mg.</em>
                </p>
                <div class="preset-group" id="vial-presets">
                    <button type="button" class="preset-btn" data-value="5">5 mg</button>
                    <button type="button" class="preset-btn preset-btn--active" data-value="10">10 mg</button>
                    <button type="button" class="preset-btn" data-value="15">15 mg</button>
                    <button type="button" class="preset-btn" data-value="custom">Other</button>
                </div>
                <div class="input-with-unit mt-4" id="custom-vial-input" style="display: none;">
                    <input type="number" class="input input--number" id="vial-mg-custom" placeholder="5-30 mg" min="0.1"
                        max="30" step="0.1">
                    <span class="input-with-unit__suffix">mg</span>
                </div>
                <!-- Inline alerts for vial amount -->
                <div class="inline-alert inline-alert--error" id="vial-alert-error"></div>
                <div class="inline-alert inline-alert--info" id="vial-alert-info"></div>
            </div>
        </section>

        <!-- Water to Add -->
        <section class="card">
            <div class="card__header">
                <span class="card__title">Water to Add</span>
            </div>

            <div class="input-group">
                <label class="input-group__label">Bacteriostatic water volume</label>
                <p class="input-group__hint">
                    The amount of water you add determines the concentration.
                    <strong>More water = less concentrated.</strong>
                    <em class="example">Example: Adding 2 mL to a 10 mg vial gives you 5 mg/mL concentration.</em>
                </p>
                <div class="preset-group" id="water-presets">
                    <button type="button" class="preset-btn" data-value="1.0">1 mL</button>
                    <button type="button" class="preset-btn preset-btn--active" data-value="2.0">2 mL</button>
                    <button type="button" class="preset-btn" data-value="3.0">3 mL</button>
                    <button type="button" class="preset-btn" data-value="custom">Other</button>
                </div>
                <div class="input-with-unit mt-4" id="custom-water-input" style="display: none;">
                    <input type="number" class="input input--number" id="diluent-ml-custom" placeholder="1-10 mL"
                        min="1" max="10" step="0.5">
                    <span class="input-with-unit__suffix">mL</span>
                </div>
                <!-- Inline alert for water volume -->
                <div class="inline-alert inline-alert--error" id="water-alert-error"></div>
                <div class="inline-alert inline-alert--info" id="water-alert-info"></div>
            </div>

            <div class="input-group">
                <label class="input-group__label">Syringe for mixing</label>
                <p class="input-group__hint">
                    Select your syringe size. Many people use the same syringe for mixing and dosing.
                </p>
                <div class="preset-group" id="mixing-syringe-presets">
                    <button type="button" class="preset-btn" data-value="0.3" data-units="30">
                        0.3 mL
                        <span class="preset-btn__sub">30 units</span>
                    </button>
                    <button type="button" class="preset-btn" data-value="0.5" data-units="50">
                        0.5 mL
                        <span class="preset-btn__sub">50 units</span>
                    </button>
                    <button type="button" class="preset-btn preset-btn--active" data-value="1.0" data-units="100">
                        1.0 mL
                        <span class="preset-btn__sub">100 units</span>
                    </button>
                    <button type="button" class="preset-btn" data-value="3.0" data-units="300">
                        3.0 mL
                        <span class="preset-btn__sub">300 units</span>
                    </button>
                    <button type="button" class="preset-btn" data-value="custom">Other</button>
                </div>
                <div class="input-with-unit mt-4" id="custom-mixing-syringe-input" style="display: none;">
                    <input type="number" class="input input--number" id="mixing-syringe-custom" placeholder="Enter mL"
                        min="0.1" step="0.1">
                    <span class="input-with-unit__suffix">mL</span>
                </div>
            </div>

            <!-- Water Draw Meter -->
            <div class="syringe-meter" id="water-meter">
                <p class="syringe-meter__title">
                    Draw <span class="highlight" id="water-meter-draw">2.0 mL</span> of bacteriostatic water
                </p>

                <!-- Multiple draws instruction -->
                <p class="syringe-meter__draws" id="water-meter-draws-info" style="display: none;"></p>

                <div class="syringe-meter__track">
                    <div class="syringe-meter__fill" id="water-meter-fill"></div>
                    <div class="syringe-meter__marker" id="water-meter-marker"></div>
                </div>

                <div class="syringe-meter__scale" id="water-meter-scale">
                    <!-- Ticks generated by JS based on syringe size -->
                </div>

                <p class="syringe-meter__info">
                    Using <span id="water-meter-syringe-label">1.0 mL</span> syringe (<span
                        id="water-meter-total-units">100</span> units)
                </p>
            </div>
        </section>

        <!-- Mixing Result -->
        <section class="card result-card" id="mixing-result">
            <div class="card__header">
                <span class="card__title">Mixing Instructions</span>
            </div>

            <div class="instruction-list">
                <div class="instruction-item">
                    <div class="instruction-item__icon">1</div>
                    <div class="instruction-item__content">
                        <strong>Clean vial tops with alcohol</strong>
                        <p>Wipe both the peptide vial and water vial, let dry</p>
                    </div>
                </div>

                <div class="instruction-item instruction-item--highlight">
                    <div class="instruction-item__icon">2</div>
                    <div class="instruction-item__content">
                        <strong>Draw <span class="highlight" id="mix-draw-water">2.0 mL</span> of bacteriostatic
                            water</strong>
                        <p>Use your <span id="mix-syringe-size">3 mL</span> syringe</p>
                    </div>
                </div>

                <div class="instruction-item">
                    <div class="instruction-item__icon">3</div>
                    <div class="instruction-item__content">
                        <strong>Inject slowly into the peptide vial</strong>
                        <p>Aim water at the side of the vial, not directly on the powder</p>
                    </div>
                </div>

                <div class="instruction-item">
                    <div class="instruction-item__icon">4</div>
                    <div class="instruction-item__content">
                        <strong>Gently roll to mix</strong>
                        <p>Roll vial between palms. <em>Do not shake.</em></p>
                    </div>
                </div>
            </div>

            <div class="result-summary-box">
                <p class="result-summary-box__label">Your reconstituted concentration</p>
                <p class="result-summary-box__value"><span id="mix-concentration">5000</span> mcg/mL</p>
                <p class="result-summary-box__note">(<span id="mix-concentration-mg">5</span> mg/mL)</p>
            </div>

            <div class="text-center mt-6">
                <button class="btn btn--primary" id="go-to-dosing-btn">
                    Continue to Dosing ‚Üí
                </button>
            </div>
        </section>
    </section>

    <!-- ============================================
         DOSING SCREEN  
         ============================================ -->
    <section class="screen" id="dosing-screen" style="display: none;">
        <section class="disclaimer">
            <strong>Note:</strong> This tool provides math and measurement guidance only.
            Always confirm with your prescriber.
        </section>

        <!-- Your Mixed Vial -->
        <section class="card card--info">
            <div class="card__header">
                <span class="card__title">Your Mixed Vial</span>
                <button class="btn-link" id="edit-mixing-btn">Edit</button>
            </div>
            <div class="info-row">
                <span><span id="dose-vial-mg">10</span> mg peptide</span>
                <span>+</span>
                <span><span id="dose-water-ml">2</span> mL water</span>
                <span>=</span>
                <span class="highlight"><span id="dose-concentration">5000</span> mcg/mL</span>
            </div>
        </section>

        <!-- Your Dose -->
        <section class="card">
            <div class="card__header">
                <span class="card__title">Your Prescribed Dose</span>
            </div>

            <div class="input-group">
                <label class="input-group__label">How much do you need per injection?</label>
                <p class="input-group__hint">
                    Enter your prescribed dose in micrograms (mcg).
                    <em class="example">Example: If prescribed "250 mcg daily", enter 250.</em>
                </p>
                <div class="input-with-unit">
                    <input type="number" class="input input--number" id="dose-mcg" placeholder="250" min="1" step="1">
                    <span class="input-with-unit__suffix">mcg</span>
                </div>
                <!-- Inline alerts for dose validation -->
                <div class="inline-alert inline-alert--info" id="dose-alert-info"></div>
                <div class="inline-alert inline-alert--warning" id="dose-alert-warning"></div>
            </div>

            <div class="input-group">
                <label class="input-group__label">Syringe for dosing</label>
                <p class="input-group__hint">
                    Use an insulin syringe for accurate small doses.
                </p>
                <div class="preset-group" id="dosing-syringe-presets">
                    <button type="button" class="preset-btn" data-value="0.3" data-units="30">
                        0.3 mL
                        <span class="preset-btn__sub">30 units</span>
                    </button>
                    <button type="button" class="preset-btn preset-btn--active" data-value="0.5" data-units="50">
                        0.5 mL
                        <span class="preset-btn__sub">50 units</span>
                    </button>
                    <button type="button" class="preset-btn" data-value="1.0" data-units="100">
                        1.0 mL
                        <span class="preset-btn__sub">100 units</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Dosing Result -->
        <section class="card result-card result-card--primary" id="dosing-result" style="display: none;">
            <div class="card__header">
                <span class="card__title">Draw This Amount</span>
            </div>

            <div class="result-primary">
                <div class="result-primary__value">
                    <span id="result-dose-ml">--</span>
                    <span class="result-primary__unit">mL</span>
                </div>
                <div class="result-primary__alt">
                    = <span id="result-dose-units">--</span> units on your syringe
                </div>
            </div>

            <!-- Visual Syringe Meter -->
            <div class="syringe-meter" id="syringe-meter">
                <p class="syringe-meter__title">
                    To get <span id="meter-dose">--</span> mcg, draw to <span class="highlight"
                        id="meter-draw-line">--</span>
                </p>

                <div class="syringe-meter__track">
                    <div class="syringe-meter__fill" id="meter-fill"></div>
                    <div class="syringe-meter__marker" id="meter-marker"></div>
                </div>

                <div class="syringe-meter__scale" id="meter-scale">
                    <!-- Ticks generated by JS based on syringe size -->
                </div>

                <p class="syringe-meter__info">
                    <span id="meter-syringe-label">0.5 mL</span> insulin syringe (<span id="meter-total-units">50</span>
                    units)
                </p>
            </div>

            <div class="result-summary">
                <p>For your <strong><span id="summary-dose">--</span> mcg</strong> dose</p>
            </div>

            <div class="result-details">
                <div class="result-details__row">
                    <span class="result-details__label">Doses per vial</span>
                    <span class="result-details__value"><span id="result-num-doses">--</span></span>
                </div>
            </div>
        </section>

        <div class="text-center mt-6 mb-6">
            <button class="btn btn--ghost" id="back-to-mixing-btn">
                ‚Üê Back to Mixing
            </button>
        </div>
    </section>
</main>
{% endblock %}